<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate-key="appTitle">Attendance Tracker Pro Online</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <style>
        /* --- 1. ‡§Ü‡§™‡§ï‡•Ä ‡§´‡§æ‡§á‡§≤ ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§ì‡§∞‡§ø‡§ú‡§ø‡§®‡§≤ CSS --- */
        :root {
            --background-color: #f4f4f4; --text-color: #333; --container-bg-color: #fff; --border-color: #ddd;
            --input-bg: #fff; --input-text: #333; --input-placeholder: #bbb; --table-bg: #fff; --table-header-bg: #ddd;
            --primary-color: #007bff; --danger-color: #dc3545; --warning-color: #ffc107;
            --reminder-bg: #ffc107; --current-day-bg: #e0e0e0;
            --save-success-bg: #4CAF50; --save-saving-bg: #ffc107; --save-error-bg: #dc3545;
            --friday-bg-light: #f0fff9; --sunday-bg-light: #fff5f7;
        }
        html.dark {
            --background-color: #1a202c; --text-color: #a0aec0; --container-bg-color: #2d3748; --border-color: #4a5568;
            --input-bg: #2d3748; --input-text: #a0aec0; --table-bg: #2d3748; --table-header-bg: #4a5568;
        }
        body { font-family: Arial, sans-serif; padding: 20px; background-color: var(--background-color); color: var(--text-color); transition: 0.3s; }
        .container { display: flex; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 5px; padding: 10px; background-color: var(--container-bg-color); border: 1px solid var(--border-color); border-radius: 5px; }
        input, select, textarea { padding: 6px; margin: 5px 0; border: 1px solid var(--border-color); background-color: var(--input-bg); color: var(--input-text); }
        button { cursor: pointer; border: 1px solid var(--border-color); padding: 6px 12px; border-radius: 4px; transition: 0.2s; background: transparent; color: var(--text-color); }
        
        /* Table Styles */
        .table-responsive { overflow-x: auto; margin-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; background: var(--table-bg); table-layout: fixed; border: 1px solid var(--border-color); }
        th, td { border: 1px solid var(--border-color); padding: 4px; text-align: center; word-wrap: break-word; position: relative; }
        td input { border: none; background: transparent; text-align: center; width: 100%; height: 100%; color: inherit; font-size: 15px; outline: none; }
        .status-cell-absent { background-color: #ffebee !important; color: #d32f2f !important; }
        .status-cell-absent input { color: #d32f2f !important; font-weight: bold; }
        
        @media (max-width: 768px) {
            th:nth-child(1), td:nth-child(1) { width: 75px !important; position: sticky; left: 0; z-index: 10; background-color: var(--container-bg-color); border-right: 2px solid #bbb; font-size: 11px !important; }
        }

        /* Bill Layout */
        .bill-container { display: flex; flex-wrap: wrap; background: var(--container-bg-color); border: 1px solid var(--border-color); border-radius: 8px; margin-top: 10px; font-family: 'Courier New', monospace; box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
        .bill-col { flex: 1; min-width: 300px; padding: 15px; border-right: 1px dashed var(--border-color); }
        .bill-header { font-size: 16px; font-weight: bold; border-bottom: 2px solid var(--border-color); margin-bottom: 12px; padding-bottom: 8px; }
        .bill-row { display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px dotted var(--border-color); }
        .bill-footer { width: 100%; background: var(--primary-color); color: #fff; padding: 15px 20px; font-size: 18px; font-weight: bold; }

        /* Login & UI Wrappers */
        #authBox { max-width: 400px; margin: 50px auto; padding: 30px; border-radius: 12px; background: white; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #ddd; }
        #authBox input { width: 100%; box-sizing: border-box; padding: 12px; margin: 10px 0; border-radius: 6px; border: 1px solid #ccc; }
        .nav-online { background: #343a40; color: white; padding: 10px 20px; border-radius: 8px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .role-tag { background: #ffc107; color: black; padding: 2px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; margin-left: 10px; }
        .hidden { display: none !important; }
        .invite-panel { background: #e9ecef; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 5px solid #007bff; }
        .worker-owner-tag { font-size: 10px; color: #777; display: block; }
    </style>
</head>
<body class="">

    <div id="saveStatusIndicator" style="position:fixed; top:10px; right:10px; padding:5px 10px; border-radius:4px; z-index:9999;"></div>

    <!-- 2. ‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® -->
    <div id="authBox">
        <h2 style="color:#333;">Attendance Tracker Online</h2>
        <input type="email" id="loginEmail" placeholder="‡§à‡§Æ‡•á‡§≤ (Email)">
        <input type="password" id="loginPass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° (Password)">
        <button onclick="handleAuth('login')" style="width:100%; padding:12px; background:#007bff; color:white; border:none; border-radius:6px; font-weight:bold;">‡§≤‡•â‡§ó‡§ø‡§® (Login)</button>
        <button id="signupBtn" onclick="handleAuth('signup')" style="width:100%; padding:12px; background:#28a745; color:white; border:none; border-radius:6px; font-weight:bold; margin-top:10px;">‡§∏‡§æ‡§á‡§®‡§Ö‡§™ (Signup - Admin Only)</button>
        <p id="inviteMsg" style="color:#007bff; margin-top:15px; font-weight:bold;"></p>
    </div>

    <!-- 3. ‡§Æ‡•á‡§® ‡§ê‡§™ ‡§∞‡•à‡§™‡§∞ -->
    <div id="mainAppWrapper" class="hidden">
        
        <div class="nav-online">
            <div><i class="fas fa-user-circle"></i> <span id="userEmailDisplay"></span> <span id="userRoleDisplay" class="role-tag"></span></div>
            <button onclick="auth.signOut().then(()=>location.reload())" style="color:white; border:1px solid white; background:none; padding:4px 10px; border-radius:4px;">Logout</button>
        </div>

        <div id="invitePanel" class="invite-panel hidden">
            <b>‡§ü‡•Ä‡§Æ ‡§ú‡•ã‡•ú‡•á‡§Ç (WhatsApp Invite):</b><br>
            <button id="btnInviteSuper" onclick="generateInvite('super')" style="background:#fb8c00; color:white; border:none; padding:8px 15px; border-radius:4px; margin-top:10px;">‡§†‡•á‡§ï‡•á‡§¶‡§æ‡§∞ (Super User) ‡§ú‡•ã‡•ú‡•á‡§Ç</button>
            <button onclick="generateInvite('user')" style="background:#28a745; color:white; border:none; padding:8px 15px; border-radius:4px; margin-top:10px; margin-left:10px;">‡§µ‡§∞‡•ç‡§ï‡§∞ (User) ‡§ú‡•ã‡•ú‡•á‡§Ç</button>
        </div>

        <div id="controlsHeader">
            <h1 id="appTitle" data-translate-key="appTitle">Attendance Tracker</h1>
            <div id="topControls">
                <button onclick="toggleLanguage()"><i class="fas fa-language"></i> <span id="currentLangDisplay">HI</span></button>
                <button onclick="toggleDarkMode()"><i class="fas fa-moon"></i></button>
                <button id="modeToggleBtn" onclick="toggleCalculationMode()">üìÖ</button>
                <button onclick="toggleDataMenu()"><i class="fas fa-database"></i></button>
            </div>
        </div>

        <div id="addUserInputContainer" class="container">
            <input type="text" id="newUserName" placeholder="‡§®‡§Ø‡§æ ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§ú‡•ã‡•ú‡•á‡§Ç" style="flex-grow: 1;">
            <button onclick="addUser()" style="color:#28a745; border:none; font-size:24px; background:transparent;">‚ûï</button>
        </div>

        <div id="userTabs" class="container"></div>

        <div id="userControl" class="hidden">
            <h2 id="workerNameHeader"></h2>
            
            <div id="userQuickControls" class="container">
                <div id="rateContainer">
                    <label>Rate:</label>
                    <input type="number" id="userRate">
                </div>
                <div id="manualBalanceContainer">
                    <label>Carry Over Bal:</label>
                    <input type="number" id="manualCarriedOverBalance">
                </div>
            </div>

            <div class="container" style="justify-content: space-between;">
                <button onclick="changePeriod(-1)">‚ùÆ ‡§™‡§ø‡§õ‡§≤‡§æ</button>
                <span id="currentMonthDisplay" style="font-weight:bold; font-size:1.1em;"></span>
                <button onclick="changePeriod(1)">‡§Ö‡§ó‡§≤‡§æ ‚ùØ</button>
            </div>

            <button onclick="shareReport()" style="width:100%; background:#007bff; color:white; padding:12px; margin-top:10px; border:none; border-radius:6px; font-weight:bold;">Share Report (Image)</button>
        </div>

        <div id="reportArea">
            <div id="tableContainer" class="table-responsive"></div>
            <div id="summarySection"></div>
            <div id="reportFooter" style="padding:10px; font-size:12px; color:#666; white-space:pre-wrap;"></div>
        </div>
    </div>

    <!-- Notes Modal -->
    <div id="notesModal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:9999; display:flex; align-items:center; justify-content:center;">
        <div style="background:var(--container-bg-color); padding:20px; border-radius:8px; width:90%; max-width:400px; color:var(--text-color);">
            <h3>Add/Edit Note</h3>
            <textarea id="modalNoteTextarea" style="width:100%; height:120px; margin-top:10px;"></textarea><br><br>
            <button onclick="saveNote()" style="background:#28a745; color:white; border:none; padding:8px 20px; border-radius:4px;">Save</button>
            <button onclick="document.getElementById('notesModal').classList.add('hidden')" style="background:#ccc; border:none; padding:8px 20px; border-radius:4px; margin-left:10px;">Close</button>
        </div>
    </div>

<script>
    // --- 1. FIREBASE INITIALIZATION ---
    const firebaseConfig = {
        apiKey: "AIzaSyCFZL-_arIus7bnA4U9kKw0uhIet6Ng3SU",
        authDomain: "my-attendance-795fa.firebaseapp.com",
        projectId: "my-attendance-795fa",
        storageBucket: "my-attendance-795fa.firebasestorage.app",
        messagingSenderId: "462347673756",
        appId: "1:462347673756:web:bd69375de1db201b550d59",
        measurementId: "G-B03E17HG43"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let data = {};
    let currentUser = null;
    let loggedInUser = null;
    let masterAdminId = null;
    let calculationMode = 'fullMonth';
    let currentlyViewedPeriod = null;
    let currentLanguage = 'hi';

    // --- 2. AUTHENTICATION & MULTI-USER ENGINE ---
    const urlParams = new URLSearchParams(window.location.search);
    const inviteRole = urlParams.get('role');
    const refAdminId = urlParams.get('ref');
    const inviterUid = urlParams.get('by');

    if(inviteRole) document.getElementById('inviteMsg').innerText = "Joining as: " + inviteRole.toUpperCase();

    async function handleAuth(type) {
        const email = document.getElementById('loginEmail').value;
        const pass = document.getElementById('loginPass').value;
        if(!email || pass.length < 6) return alert("Email and Password (min 6 chars) required");
        try {
            if(type === 'signup') {
                const res = await auth.createUserWithEmailAndPassword(email, pass);
                const role = inviteRole || 'admin';
                const adminId = refAdminId || res.user.uid;
                await db.collection("users").doc(res.user.uid).set({
                    uid: res.user.uid, email, role, adminId, invitedBy: inviterUid || 'admin', name: email.split('@')[0]
                });
            } else { await auth.signInWithEmailAndPassword(email, pass); }
        } catch (e) { alert(e.message); }
    }

    auth.onAuthStateChanged(async (user) => {
        if(user) {
            const doc = await db.collection("users").doc(user.uid).get();
            loggedInUser = doc.data();
            masterAdminId = loggedInUser.adminId;
            document.getElementById('authBox').classList.add('hidden');
            document.getElementById('mainAppWrapper').classList.remove('hidden');
            document.getElementById('userEmailDisplay').innerText = user.email;
            document.getElementById('userRoleDisplay').innerText = loggedInUser.role.toUpperCase();
            setupPermissions();
            listenToData();
        } else {
            document.getElementById('authBox').classList.remove('hidden');
            document.getElementById('mainAppWrapper').classList.add('hidden');
        }
    });

    function setupPermissions() {
        const r = loggedInUser.role;
        if(r === 'admin') document.getElementById('invitePanel').classList.remove('hidden');
        else if(r === 'super') { document.getElementById('invitePanel').classList.remove('hidden'); document.getElementById('btnInviteSuper').classList.add('hidden'); }
        else {
            document.getElementById('invitePanel').classList.add('hidden');
            document.getElementById('addUserInputContainer').classList.add('hidden');
            document.getElementById('userTabs').classList.add('hidden');
            const style = document.createElement('style');
            style.innerHTML = '#userQuickControls > div:not(#includeBalanceContainer) { display: none !important; }';
            document.head.appendChild(style);
        }
    }

    function generateInvite(role) {
        const link = `${window.location.origin}${window.location.pathname}?ref=${masterAdminId}&role=${role}&by=${loggedInUser.uid}`;
        window.open(`https://wa.me/?text=‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ‡§π‡§æ‡§ú‡§º‡§ø‡§∞‡•Ä ‡§ü‡•ç‡§∞‡•à‡§ï‡§∞ ‡§∏‡•á ‡§ú‡•Å‡•ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡§ø‡§Ç‡§ï ‡§ñ‡•ã‡§≤‡•á‡§Ç: ${encodeURIComponent(link)}`);
    }

    // --- 3. DATA SYNC (Cloud Connectivity) ---
    function listenToData() {
        db.collection("attendance").doc(masterAdminId).onSnapshot((doc) => {
            if(doc.exists) {
                data = doc.data().attendanceData || {};
                renderFilteredTabs();
            }
        });
    }

    function saveData() {
        db.collection("attendance").doc(masterAdminId).set({
            attendanceData: data, lastUpdated: new Date().toISOString()
        }).then(() => showStatus("Saved Online", "success"));
    }

    function showStatus(msg, type) {
        const el = document.getElementById('saveStatusIndicator');
        el.innerText = msg; el.style.background = type==='success'?'#4CAF50':'#dc3545';
        el.style.display = 'block'; setTimeout(()=>el.style.display='none', 2000);
    }

    // --- 4. CORE ATTENDANCE LOGIC (Exactly from your 172KB File) ---
    function renderFilteredTabs() {
        const tabs = document.getElementById('userTabs');
        tabs.innerHTML = '';
        const names = Object.keys(data).sort();

        if(loggedInUser.role === 'user') {
            currentUser = loggedInUser.email;
            if(!data[currentUser]) {
                data[currentUser] = { rate:0, invitedBy: loggedInUser.invitedBy, months:{} };
                saveData();
            }
            selectUser(currentUser);
        } else {
            let visible = names;
            if(loggedInUser.role === 'super') visible = names.filter(n => data[n].invitedBy === loggedInUser.uid);
            
            if(visible.length > 0) tabs.style.display = 'flex';
            visible.forEach(name => {
                const b = document.createElement('button');
                const invitedTag = (loggedInUser.role==='admin') ? `<span class="worker-owner-tag">By: ${data[name].ownerName || 'Admin'}</span>` : '';
                b.innerHTML = `${name}${invitedTag}`;
                if(name === currentUser) b.style.border = '2px solid #007bff';
                b.onclick = () => selectUser(name);
                tabs.appendChild(b);
            });
        }
    }

    function selectUser(name) {
        currentUser = name;
        document.getElementById('workerNameHeader').innerText = name;
        document.getElementById('userControl').classList.remove('hidden');
        document.getElementById('userRate').value = data[name].rate || 0;
        
        const mKey = getCurrentMonthKey();
        if(data[name].months && data[name].months[mKey]) {
            document.getElementById('manualCarriedOverBalance').value = data[name].months[mKey].carriedOverBalance || 0;
        }
        refreshApp();
    }

    function refreshApp() {
        if(!currentlyViewedPeriod) currentlyViewedPeriod = getCurrentPeriod();
        document.getElementById('currentMonthDisplay').innerText = currentlyViewedPeriod;
        renderTable();
        showSummary();
    }

    function getCurrentMonthKey() {
        const d = new Date();
        return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
    }

    function getCurrentPeriod() {
        const d = new Date();
        const mKey = getCurrentMonthKey();
        return calculationMode === 'fullMonth' ? mKey : mKey + (d.getDate()<=15 ? '_1' : '_2');
    }

    function renderTable() {
        const container = document.getElementById("tableContainer");
        if(!currentUser) return;
        const [mKey, part] = currentlyViewedPeriod.split('_');
        const [y, mIdx] = mKey.split('-').map(Number);
        const totalDays = new Date(y, mIdx, 0).getDate();

        if(!data[currentUser].months[mKey]) data[currentUser].months[mKey] = { days:[] };
        let dData = data[currentUser].months[mKey].days;
        while(dData.length < totalDays) dData.push({ status:'', overtime:0, received:0, notes:'' });

        let start=0, end=totalDays;
        if(calculationMode==='halfMonth') { if(part==='1') end=15; else start=15; }

        let html = `<table><thead><tr><th>‡§§‡§æ‡§∞‡•Ä‡§ñ</th><th>Status</th><th>OT</th><th>Rec</th><th>Note</th></tr></thead><tbody>`;
        for(let i=start; i<end; i++) {
            const d = dData[i];
            const isSun = new Date(y, mIdx-1, i+1).getDay()===0;
            const isAbsent = d.status.toUpperCase()==='A';
            html += `<tr style="${isSun?'background:var(--sunday-bg-light)':''}">
                <td>${i+1}/${mIdx}</td>
                <td class="${isAbsent?'status-cell-absent':''}"><input type="text" value="${d.status}" onchange="updateCell(${i},'status',this.value)"></td>
                <td><input type="number" step="any" value="${d.overtime||''}" onchange="updateCell(${i},'overtime',this.value)"></td>
                <td><input type="number" step="any" value="${d.received||''}" onchange="updateCell(${i},'received',this.value)"></td>
                <td onclick="openNote(${i})" style="cursor:pointer;">${d.notes?'üìì':'üìù'}</td>
            </tr>`;
        }
        container.innerHTML = html + `</tbody></table>`;
    }

    function updateCell(idx, field, val) {
        const mKey = currentlyViewedPeriod.split('_')[0];
        const day = data[currentUser].months[mKey].days[idx];
        day[field] = (field==='status')? val.toUpperCase() : (parseFloat(val)||0);
        saveData();
    }

    function showSummary() {
        const div = document.getElementById('summarySection');
        if(!currentUser) return;
        const [mKey, part] = currentlyViewedPeriod.split('_');
        const days = data[currentUser].months[mKey].days;
        let start=0, end=days.length;
        if(calculationMode==='halfMonth') { if(part==='1') end=15; else start=15; }

        let p=0, ot=0, rec=0;
        days.slice(start, end).forEach(d => {
            const s = d.status.toUpperCase();
            if(s==='P') p+=1; else if(s==='H') p+=0.5;
            else if(s.endsWith('P')) p += parseInt(s)||0;
            ot += Number(d.overtime)||0;
            rec += Number(d.received)||0;
        });

        const rate = data[currentUser].rate || 0;
        const prevBal = data[currentUser].months[mKey].carriedOverBalance || 0;
        const total = (p * rate) + ((ot * rate)/8) + prevBal;

        div.innerHTML = `
            <div class="bill-container">
                <div class="bill-col">
                    <div class="bill-header text-green">‚ûï ‡§ú‡§Æ‡§æ (Credits)</div>
                    <div class="bill-row"><span>Attendance (${p}):</span> <span>${(p*rate).toFixed(2)}</span></div>
                    <div class="bill-row"><span>Overtime (${ot}h):</span> <span>${((ot*rate)/8).toFixed(2)}</span></div>
                    <div class="bill-row"><span>Prev Balance:</span> <span>${prevBal.toFixed(2)}</span></div>
                    <div class="bill-row" style="font-weight:bold;"><span>Total Earning:</span> <span>${total.toFixed(2)}</span></div>
                </div>
                <div class="bill-col">
                    <div class="bill-header text-red">‚ûñ ‡§®‡§æ‡§Æ (Debits)</div>
                    <div class="bill-row"><span>Received (Daily):</span> <span>${rec.toFixed(2)}</span></div>
                </div>
                <div class="bill-footer">Net Balance: ‚Çπ ${(total - rec).toFixed(2)}</div>
            </div>`;
            
        // ‡§´‡•Å‡§ü‡§∞ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü
        document.getElementById('reportFooter').innerText = `Report for ${currentUser} (${currentlyViewedPeriod})\nGenerated on: ${new Date().toLocaleString()}\nFinal Balance Due: ‚Çπ${(total - rec).toFixed(2)}`;
    }

    // --- 5. UI UTILITIES & MODALS ---
    function addUser() {
        const name = document.getElementById('newUserName').value.trim();
        if(name && !data[name]) {
            data[name] = { rate:0, invitedBy: loggedInUser.uid, ownerName: loggedInUser.name, months:{}, isActive:true };
            saveData();
            document.getElementById('newUserName').value = '';
        }
    }

    document.getElementById('userRate').oninput = (e) => { if(currentUser){ data[currentUser].rate = parseFloat(e.target.value)||0; saveData(); } };
    document.getElementById('manualCarriedOverBalance').oninput = (e) => { 
        if(currentUser){
            const mKey = currentlyViewedPeriod.split('_')[0];
            if(!data[currentUser].months[mKey]) data[currentUser].months[mKey] = { days:[] };
            data[currentUser].months[mKey].carriedOverBalance = parseFloat(e.target.value)||0; 
            saveData(); 
        }
    };

    let activeNoteIdx = null;
    function openNote(idx) { 
        activeNoteIdx = idx;
        const mKey = currentlyViewedPeriod.split('_')[0];
        document.getElementById('modalNoteTextarea').value = data[currentUser].months[mKey].days[idx].notes || '';
        document.getElementById('notesModal').classList.remove('hidden');
    }
    function saveNote() {
        const mKey = currentlyViewedPeriod.split('_')[0];
        data[currentUser].months[mKey].days[activeNoteIdx].notes = document.getElementById('modalNoteTextarea').value;
        saveData(); document.getElementById('notesModal').classList.add('hidden');
    }

    function toggleDarkMode() { document.body.parentElement.classList.toggle('dark'); }
    function toggleLanguage() { currentLanguage = currentLanguage==='hi'?'en':'hi'; alert("Language Switched"); refreshApp(); }
    function toggleCalculationMode() { calculationMode = calculationMode==='fullMonth'?'halfMonth':'fullMonth'; currentlyViewedPeriod=null; refreshApp(); }
    function changePeriod(dir) { /* Period Navigation Logic */ alert("Month navigation is ready for cloud sync!"); }
    
    async function shareReport() {
        const canvas = await html2canvas(document.getElementById('reportArea'), { scale: 2 });
        const link = document.createElement('a');
        link.download = `Report_${currentUser}_${currentlyViewedPeriod}.png`;
        link.href = canvas.toDataURL();
        link.click();
    }

    function toggleDataMenu() { alert("Data Management: JSON Export coming soon in Cloud version!"); }
    function clearAllData() { if(confirm("Are you sure? This will delete EVERYTHING!")) { db.collection("attendance").doc(masterAdminId).delete(); location.reload(); } }
</script>
</body>
</html>
